

generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model User {
  id        String   @id @default(cuid())
  clerkId   String   @unique
  fullName  String?
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Enum helps track the state of the PDF (Essential for UX)
enum UploadStatus {
  PENDING
  PROCESSING
  FAILED
  SUCCESS
}

model File {
  id           String       @id @default(cuid())
  userId       String       // Clerk User ID matches this
  name         String       // e.g., "financial-report.pdf"
  size         Int?          // Size in bytes new field
  uploadStatus UploadStatus @default(PENDING)
  url          String       // The UploadThing URL
  key          String       // The UploadThing Key (needed to delete files)
  // @db.Text is CRITICAL. 
  // Standard String holds ~191 chars. @db.Text holds unlimited chars.
  // You need this for 300-page PDFs.
  extractedText String?     @db.Text 
  summary       String?     @db.Text
  messages      Message[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
}

model Message {
  id            String   @id @default(cuid())
  text          String   @db.Text // Chat messages can be long too
  isUserMessage Boolean  // true = User asked, false = AI answered
  // Relationship to File
  fileId        String?
  file          File?    @relation(fields: [fileId], references: [id], onDelete: Cascade)
  userId        String   // Redundant but useful for security lookups
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  // Indexes make searching fast
  @@index([fileId])
  @@index([userId])
}

